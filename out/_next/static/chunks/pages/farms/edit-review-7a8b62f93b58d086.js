(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6339],{29149:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/farms/edit-review",function(){return n(72011)}])},92618:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r=n(85893),i=n(91371),a=n(37012),s=n(31139),d=n(50352),l=n(27993),o=n(67294),c=n(66180),u=n(6994),m=n(36868);function f(e){let{componentRef:t,className:n,panelClassName:l,arrowClassName:f,children:w,forceOpen:v,placement:x="top",triggerBy:Z,closeBy:g="click-outside-but-trigger",disable:b,defaultOpen:p,darkGradient:T=!1,autoClose:y,...j}=e,k=(0,o.useRef)(),N=(0,o.useMemo)(()=>(0,d.kp)(w,h,e=>(0,a.Z)(e,{$isRenderByMain:!0,$popoverRef:k})),[w]),P=(0,i.ZP)(e=>e.isMobile);return(0,r.jsxs)(m.Z,{componentRef:(0,s.Z)(t,k),canOpen:!b,placement:P?"top":x,defaultOpen:p,triggerBy:null!=Z?Z:P?"click":"hover",forceOpen:v,className:n,triggerDelay:100,closeBy:g,closeDelay:100,autoClose:y,...j,children:[(0,r.jsx)(m.Z.Button,{children:w}),(0,r.jsx)(m.Z.Panel,{children:e=>{let{locationInfo:t}=e;return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:(0,c.m)("w-2 h-2 absolute bg-[#0C0926] rotate-45 -translate-x-1 -translate-y-1",T?"bg-[transparent]":"",f),style:t?{top:t.arrowTopRelativeToPanel,left:t.arrowLeftRelativeToPanel}:{visibility:"hidden"}}),(0,r.jsx)(u.Z,{className:(0,c.m)("TooltipPanel p-4 bg-[#0C0926] rounded-lg text-xs text-white",l),style:{background:T?"linear-gradient(140.14deg, rgba(0, 182, 191, 0.15) 0%, rgba(27, 22, 89, 0.1) 86.61%), linear-gradient(321.82deg, #18134D 0%, #1B1659 100%)":"default",border:T?"1px solid  rgba(171, 196, 255, 0.2)":"none"},children:N})]})}})]})}function h(e){var t;let{$isRenderByMain:n,$popoverRef:i,children:a,className:s}=e;return n?(0,r.jsx)("div",{className:s,children:(0,l.u)(a,[null!==(t=null==i?void 0:i.current)&&void 0!==t?t:{}])}):null}f.Panel=h},14033:function(e,t,n){"use strict";n.d(t,{S:function(){return a}});var r=n(99881),i=n(84207);function a(e,t){var n;let a=e=>(0,r.Z)(e.toFixed(null!==(n=null==t?void 0:t.decimalPlace)&&void 0!==n?n:2,null==t?void 0:t.format,null==t?void 0:t.rounding),{fractionLength:"auto",...t}),s=(0,i.Z)(e);try{let e=s.toFixed(0),n=e.length;if(!(null==t?void 0:t.disabled)&&n>9)return"".concat(a(s.div(1e9)),"B");if(!(null==t?void 0:t.disabled)&&n>6)return"".concat(a(s.div(1e6)),"M");if(!(null==t?void 0:t.disabled)&&n>3)return"".concat(a(s.div(1e3)),"K");return"".concat(a(s))}catch(e){return"0"}}},99881:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(72573);function i(e){let{groupSeparator:t=",",fractionLength:n=2,groupSize:i=3}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===e?"0":[e=>(0,r.B)(e),e=>"auto"===n?e:function(e,t){var n;let[,r="",i="",a=""]=null!==(n=e.match(/(-?)(\d*)\.?(\d*)/))&&void 0!==n?n:[];return a?a.length<t?String(e):Number(e).toFixed(t):String(e)}(e,n),e=>{var n;let[,r="",a="",s=""]=null!==(n=e.match(/(-?)(\d*)\.?(\d*)/))&&void 0!==n?n:[],d=[...a].reduceRight((e,n,r,a)=>{let s=a.length-1-r;return n+(0!==s&&s%i==0?t:"")+e},"");return s?"".concat(r).concat(d,".").concat(s):"".concat(r).concat(d)}].reduce((e,t)=>t(e),e)}},95865:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(14033);function i(e,t){return e?"$".concat((0,r.S)(e,{...t,disabled:!(null==t?void 0:t.autoSuffix)})):"$0"}},72011:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var r=n(85893),i=n(91371),a=n(95657),s=n(72305),d=n(79938),l=n(34003),o=n(98360),c=n(56419),u=n(90547),m=n(3363),f=n(4465),h=n(14209),w=n(51523),v=n(71375),x=n(49641),Z=n(42186),g=n(80582),b=n(19036),p=n(53002),T=n(13521),y=n(43724);async function j(e){let{...t}=e;return(0,d.ZP)(async e=>{let{transactionCollector:n,baseUtils:{owner:r,connection:i}}=e,{hydratedInfos:j}=x.Z.getState(),{rewards:k,farmId:N}=T.Z.getState(),P=j.find(e=>(0,m.ZP)(e.id)===N);(0,l.Z)(N,"target farm id is missing"),(0,l.Z)(P,"can't find target farm");let S=k.filter(e=>(0,a.uk)(e)&&"existed reward"===e.type),E=k.filter(e=>"new added"===e.type),{valid:C,reason:R}=(0,y.f6)(E);(0,l.Z)(C,R);let B=await (0,o.ZP)(S,async e=>{let{innerTransactions:t}=await function(e){var t,n,r,i;let{connection:a,reward:o,farmInfo:m}=e,{owner:x,tokenAccountRawInfos:T,txVersion:y}=p.Z.getState();(0,l.Z)(x&&(0,f.aT)(x,o.owner),"reward is not created by walletOwner"),(0,l.Z)(o.token,"reward must have token"),(0,l.Z)(o.endTime,"reward must have endTime"),(0,l.Z)(null===(t=o.originData)||void 0===t?void 0:t.endTime,"reward's originData must have endTime"),(0,l.Z)(o.startTime,"reward must have startTime"),(0,l.Z)(o.amount,"reward must have amount"),(0,l.Z)(o.owner,"reward must have creator");let j=(0,c.V1)(o.startTime).getTime(),k=(0,c.V1)(o.endTime).getTime(),N=(0,w.hi)(o.amount,(0,u.nB)(k-j).seconds),P={rewardMint:(0,Z.Dn)(o.token)?g.YG:null===(n=o.token)||void 0===n?void 0:n.mint,rewardOpenTime:(0,v.Z)((0,w.hi)(j,1e3)).toNumber(),rewardEndTime:(0,v.Z)((0,w.hi)(k,1e3)).toNumber(),rewardPerSecond:(0,v.Z)((0,w.dC)(N,(0,h.Bd)("1",null!==(i=null===(r=o.token)||void 0===r?void 0:r.decimals)&&void 0!==i?i:6))),rewardType:o.isOptionToken?"Option tokens":"Standard SPL"};return s.l6j.makeRestartFarmInstructionSimple({poolKeys:(0,b.R)(m.jsonInfo),connection:a,userKeys:{owner:x,tokenAccounts:T},newRewardInfo:P,makeTxVersion:y,lookupTableCache:d.eq})}({reward:e,farmInfo:P,connection:i});return t}),O=await (0,o.ZP)(E,async e=>{let{innerTransactions:t}=await function(e){let{connection:t,reward:n,farmInfo:r}=e,{owner:i,tokenAccountRawInfos:a,txVersion:o}=p.Z.getState();(0,l.Z)(i,"Wallet not connected");let m=n.token;(0,l.Z)(n.startTime,"reward start time is required"),(0,l.Z)(n.endTime,"reward end time is required"),(0,l.Z)(n.amount,"reward amount is required"),(0,l.Z)(m,"can't find selected reward token");let f=(0,c.V1)(n.startTime).getTime(),x=(0,c.V1)(n.endTime).getTime(),T=(0,w.hi)(n.amount,(0,u.nB)(x-f).seconds),y={rewardOpenTime:(0,v.Z)((0,w.hi)(f,1e3)),rewardEndTime:(0,v.Z)((0,w.hi)(x,1e3)),rewardMint:(0,Z.Dn)(m)?g.YG:m.mint,rewardPerSecond:(0,v.Z)((0,w.dC)(T,(0,h.Bd)(1,m.decimals))),rewardType:n.isOptionToken?"Option tokens":"Standard SPL"};return s.l6j.makeFarmCreatorAddRewardTokenInstructionSimple({poolKeys:(0,b.R)(r.jsonInfo),connection:t,userKeys:{owner:i,tokenAccounts:a},newRewardInfo:y,makeTxVersion:o,lookupTableCache:d.eq})}({reward:e,farmInfo:P,connection:i});return t});n.add([...B.flat(),...O.flat()],{...t,txHistoryInfo:{title:"Edit Farm",description:"(Click to see details)"}})})}var k=n(31555),N=n(31166),P=n(99522),S=n(43067),E=n(54592),C=n(42885),R=n(51800),B=n(44516),O=n(28723),F=n(3113),_=n(56053),D=n(67294);function I(){let e=(0,N.ZP)(e=>e.getToken),{poolId:t,rewards:n,farmId:s}=(0,T.Z)(),d=(0,i.ZP)(e=>e.isApprovePanelShown),o=(0,i.ZP)(e=>e.isMobile);(0,D.useMemo)(()=>(0,B.Z)(()=>((0,l.Z)(t,"poolId is not defined"),n.forEach(e=>{(0,l.Z)(e.amount,"reward amount is not defined"),(0,l.Z)(e.token,"reward token is not defined"),(0,l.Z)(e.startTime,"reward start time is not defined"),(0,l.Z)(e.endTime,"reward end time is not defined")}),!0),()=>!1),[t,n,e]);let c=n.filter(e=>"new added"===e.type),u=n.filter(e=>(0,a.uk)(e));(0,D.useEffect)(()=>{T.Z.getState().isRoutedByCreateOrEdit||(0,k.Eh)("/farms",{queryProps:{currentTab:"Ecosystem"}})},[]);let m=(0,r.jsx)(S.Z,{className:"frosted-glass-teal",isLoading:d,size:o?"sm":"lg",validators:[{should:c.length>0||u.length>0}],onClick:()=>{j({onTxSuccess:()=>{setTimeout(()=>{(0,k.Eh)("/farms",{queryProps:{currentTab:"Ecosystem"}}),T.Z.setState({rewards:[(0,a.k8)()]}),x.Z.getState().refreshFarmInfos(),T.Z.setState({isRoutedByCreateOrEdit:!1})},1e3)}})},children:"Confirm Farm Changes"}),f=(0,r.jsx)(S.Z,{className:"frosted-glass-skygray mobile:w-full",size:o?"sm":"lg",onClick:k.Bv,children:"Edit"});return(0,r.jsx)(C.Z,{metaTitle:"Farms - Raydium",mobileBarTitle:"Edit Farm",children:(0,r.jsxs)("div",{className:"self-center w-[min(720px,90vw)]",children:[!o&&(0,r.jsxs)(R.Z,{className:"mb-8 justify-self-start items-baseline gap-2",children:[(0,r.jsx)("div",{className:"text-2xl mobile:text-lg font-semibold text-white",children:"Edit Farm"}),s&&(0,r.jsxs)("div",{className:"text-sm mobile:text-xs font-semibold text-[#abc4ff80]",children:["Farm ID:",(0,r.jsx)("div",{className:"inline-block ml-1",children:(0,r.jsx)(P.U,{className:"flex-nowrap whitespace-nowrap",canCopy:!0,iconClassName:"hidden",textClassName:"text-sm mobile:text-xs font-semibold text-[#abc4ff80] whitespace-nowrap",showDigitCount:6,children:s})})]})]}),(0,r.jsx)("div",{className:"mb-8 text-xl mobile:text-lg font-semibold justify-self-start text-white",children:"Review farm details"}),(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("div",{className:"mb-3 text-[#abc4ff] text-sm font-medium justify-self-start",children:"Pool"}),(0,r.jsx)(_.j,{})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"mb-3 text-[#abc4ff] text-sm font-medium justify-self-start",children:"Existing farm rewards"}),(0,r.jsx)(O.t,{canUserEdit:!1})]}),c.length>0&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"mb-3 text-[#abc4ff] text-sm font-medium justify-self-start",children:"New farm rewards"}),(0,r.jsx)(F.D,{canUserEdit:!1})]}),o?(0,r.jsxs)(E.Z,{className:"gap-3 mt-12 justify-center",children:[m,f]}):(0,r.jsxs)(R.Z,{className:"gap-5 mt-12 justify-center",children:[m,f]})]})})}}},function(e){e.O(0,[4740,2885,2820,3129,6523,9774,2888,179],function(){return e(e.s=29149)}),_N_E=e.O()}]);